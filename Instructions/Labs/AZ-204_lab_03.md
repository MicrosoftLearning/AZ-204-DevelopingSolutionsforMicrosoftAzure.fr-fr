---
lab:
  az204Title: 'Lab 03: Retrieve Azure Storage resources and metadata by using the Azure Storage SDK for .NET'
  az020Title: 'Lab 03: Retrieve Azure Storage resources and metadata by using the Azure Storage SDK for .NET'
  az204Module: 'Module 03: Develop solutions that use blob storage'
  az020Module: 'Module 03: Develop solutions that use blob storage'
---

# <a name="lab-03-retrieve-azure-storage-resources-and-metadata-by-using-the-azure-storage-sdk-for-net"></a>Lab 03 : Récupérer des ressources et métadonnées de Stockage Azure à l’aide du Kit de développement logiciel (SDK) Stockage Azure pour .NET

## <a name="microsoft-azure-user-interface"></a>Interface utilisateur Microsoft Azure

Étant donné la nature dynamique des outils cloud Microsoft, il se peut que vous constatiez des modifications de l’interface utilisateur Azure après le développement du contenu de cette formation. Il se peut donc que certaines instructions et étapes du labo ne s’alignent pas correctement.

Microsoft met ce cours à jour quand la communauté l’alerte sur la nécessité d’y apporter des modifications. Toutefois, compte tenu de la fréquence des mises à jour cloud, il se peut que vous rencontriez des modifications de l’interface utilisateur avant les mises à jour du contenu de cette formation. **Si cela se produit, adaptez-vous aux changements, puis appliquez-les dans les laboratoires si nécessaire.**

## <a name="instructions"></a>Instructions

### <a name="before-you-start"></a>Avant de commencer

#### <a name="sign-in-to-the-lab-environment"></a>Se connecter à l’environnement de labo

Connectez-vous à votre machine virtuelle Windows 10 en utilisant les informations d’identification suivantes :

-   Nom d’utilisateur : **Administrateur**

-   Mot de passe : **Pa55w.rd**

> **Remarque** : Votre instructeur vous fournira des instructions pour la connexion à l’environnement de laboratoire virtuel.

#### <a name="review-the-installed-applications"></a>Passer en revue les applications installées

Localisez la barre des tâches sur votre bureau Windows 10. La barre des tâches contient les icônes des applications que vous allez utiliser dans ce labo, à savoir :

-   Microsoft Edge

-   Explorateur de fichiers

## <a name="architecture-diagram"></a>Diagramme de l'architecture

![Diagramme d’architecture montrant un utilisateur en train de récupérer des ressources et métadonnées de Stockage Azure à l’aide du Kit de développement logiciel (SDK) Stockage Azure pour .NET.](./media/Lab03-Diagram.png)

### <a name="exercise-1-create-azure-resources"></a>Exercice 1 : Créer des ressources Azure

#### <a name="task-1-open-the-azure-portal"></a>Tâche 1 : Ouvrir le portail Azure

1.  Dans la barre des tâches, sélectionnez l’icône **Microsoft Edge**.

1. Dans la fenêtre du navigateur, accédez au portail Azure (<https://portal.azure.com>), puis connectez-vous au compte que vous allez utiliser pour ce laboratoire.

   > **Remarque** : Si vous vous connectez au portail Azure la première fois, une visite guidée du portail vous sera proposée. Sélectionnez **Prise en main** pour faire l’impasse sur la visite guidée et commencer à utiliser le portail.

#### <a name="task-2-create-a-storage-account"></a>Tâche 2 : Créer un compte de stockage

1.  Dans le portail Azure, utilisez la zone de texte **Rechercher des ressources, des services et des documents** pour rechercher **Comptes de stockage**, puis, dans la liste des résultats, sélectionnez **Comptes de stockage**.

1.  Dans le volet **Comptes de stockage**, sélectionnez **+ Créer**.

1.  Dans le volet **Créer un compte de stockage**, sous l’onglet **Informations de base**, effectuez les actions suivantes, puis sélectionnez **Vérifier** :

   | Paramètre | Action |
   | -- | -- |
   | Liste déroulante  **Abonnement** | Conservez les valeurs par défaut. |
   | Section **Groupe de ressources** | Sélectionnez **Créer**, entrez **StorageMedia**, puis sélectionnez **OK** |
   | Zone de texte **Nom de compte de stockage** | Entrez **mediastor** _[votrenom]_ |
   | Liste déroulante **Région** | Sélectionnez **(États-Unis) USA Est** |
   | Section **Performance** | Sélectionnez l’option **Standard**. |
   | Liste déroulante **Redondance** | Sélectionnez **Stockage localement redondant (LRS)** . |

   La capture d’écran suivante affiche les paramètres configurés dans le volet **Créer un compte de stockage**.
 
   ![Volet Créer un compte de stockage.](./media/l03_create_a_storage_account.png)
   
1.  Sous l’onglet **Vérifier**, passez en revue les options que vous avez sélectionnées dans les étapes précédentes.

1.  Sélectionnez **Créer** pour créer le compte de stockage à l’aide de votre configuration spécifiée.

    > **Remarque** : Attendez que la tâche de création soit terminée avant de poursuivre ce labo.

1.  Sélectionnez **Accéder à la ressource**.

1.  Dans le volet **Compte de stockage**, dans la section **Paramètres**, sélectionnez le lien **Points de terminaison**.

1.  Dans la section **Points de terminaison**, copiez la valeur de la zone de texte **service BLOB** dans le Presse-papiers.

    > **Remarque** : vous allez utiliser cette valeur de point de terminaison plus tard dans ce labo.

1.  Ouvrez Bloc-notes, puis collez-y la valeur de service BLOB copiée.

1.  Dans le volet **Compte de stockage**, dans la section **Sécurité et réseau**, sélectionnez **Clés d’accès**.

1.  Copiez la valeur **Nom du compte stockage** dans le Presse-papiers, puis collez-la dans Bloc-notes.

1.  Dans le volet **Clés d’accès**, sélectionnez **Afficher les clés**.

1.  Examinez chacune des clés, puis copiez la valeur de l’une des zones **Clé** dans le Presse-papiers.

    > **Remarque** : vous allez utiliser ces valeurs plus tard dans ce labo.

#### <a name="review"></a>Révision

Dans cet exercice, vous avez créé un compte de stockage à utiliser jusqu’à la fin de ce labo.

### <a name="exercise-2-upload-a-blob-into-a-container"></a>Exercice 2 : Charger un objet blob dans un conteneur

#### <a name="task-1-create-storage-account-containers"></a>Tâche 1 : Créer des conteneurs de compte de stockage

1. Dans le volet **Compte de stockage**, dans la section **Stockage des données**, sélectionnez le lien **Conteneurs**.

1. Dans la section **Conteneurs**, sélectionnez **+ Conteneur**.

1. Dans la fenêtre contextuelle **Nouveau conteneur**, effectuez les actions suivantes, puis sélectionnez **Créer** :

    | Paramètre | Action |
    | -- | -- |
    | Zone de texte **Nom** | Entrez **raster-graphics** |
    | Liste déroulante **Niveau d’accès public** | Sélectionnez **Privé (aucun accès anonyme)** |

1. Dans la section **Conteneurs**, sélectionnez **+ Conteneur**.

1. Dans la fenêtre contextuelle **Nouveau conteneur**, effectuez les actions suivantes, puis sélectionnez **Créer** :

    | Paramètre | Action |
    | -- | -- |
    | Zone de texte **Nom** | Entrez **compressed-audio** |
    | Liste déroulante **Niveau d’accès public** | Sélectionnez **Privé (aucun accès anonyme)** |

1. Dans la section **Conteneurs**, observez la liste des conteneurs mise à jour.

    La capture d’écran suivante affiche les paramètres configurés dans le volet **Créer un compte de stockage**.

    ![Volet Créer un compte de stockage.](./media/l03_containers.png)

#### <a name="task-2-upload-a-storage-account-blob"></a>Tâche 2 : Charger un blob de compte de stockage

1.  Dans la section **Conteneurs**, sélectionnez le conteneur **raster-graphics** nouvellement créé.

1.  Dans le volet **Conteneur**, sélectionnez **Charger**.

1.  Dans la fenêtre **Charger l’objet blob**, effectuez les actions suivantes, puis sélectionnez **Charger** :

   | Paramètre | Action |
   | -- | -- |
   | Section **Fichiers** | Sélectionnez l’icône **Dossier** |
   | Fenêtre **Explorateur de fichiers** | Accédez à **Allfiles (F):\\Allfiles\\Labs\\03\\Starter\\Images**, sélectionnez le fichier **graph.jpg**, puis **Ouvrir** |
   | Case à cocher **Remplacer si les fichiers existent déjà** | Vérifiez que la case est cochée |
   
   > **Remarque** : attendez que le chargement du blob soit terminé avant de poursuivre ce labo.

#### <a name="review"></a>Révision

Dans cet exercice, vous avez créé des conteneurs d’espaces réservés dans le compte Stockage, puis rempli l’un d’eux avec un blob.

### <a name="exercise-3-access-containers-by-using-the-net-sdk"></a>Exercice 3 : Accéder aux conteneurs à l’aide du Kit de développement logiciel (SDK) .NET

#### <a name="task-1-create-net-project"></a>Tâche 1 : Créer un projet .NET

1.  Dans l’écran **Démarrage**, sélectionnez la vignette **Visual Studio Code**.

1.  Dans le menu **Fichier**, sélectionnez **Ouvrir un dossier**, accédez à **Allfiles (F):\\Allfiles\\Labs\\03\\Starter\\BlobManager**, puis choisissez **Sélectionner un dossier**.

1.  Dans la fenêtre **Visual Studio Code**, dans la barre de menus, sélectionnez **Terminal**, puis **Nouveau terminal**.

1.  Dans le terminal, exécutez la commande suivante pour créer un projet .NET nommé **BlobManager** dans le dossier actif :

    ```
    dotnet new console --framework net6.0 --name BlobManager --output .
    ```

    > **Remarque** : La commande **dotnet new** crée un projet de **console** dans un dossier du même nom que le projet.

1.  Dans le terminal, exécutez la commande suivante pour importer la version 12.12.0 d’**Azure.Stockage.Blobs** à partir de NuGet :

    ```
    dotnet add package Azure.Storage.Blobs --version 12.12.0
    ```

    > **Remarque** : la commande **dotnet add package** ajoute le package **Azure.Storage.Blobs** à partir de NuGet. Pour plus d’informations, consultez [Azure.Storage.Blobs](https://www.nuget.org/packages/Azure.Storage.Blobs/12.12.0).

1.  Dans le terminal, exécutez la commande suivante pour générer l’application web .NET :

    ```
    dotnet build
    ```

1.  Sélectionnez **Tuer le terminal** ou l’icône **Corbeille** pour fermer le terminal actuellement ouvert et tous les processus associés.

#### <a name="task-2-modify-the-program-class-to-access-storage"></a>Tâche 2 : Modifier la classe Program pour accéder au Stockage

1.  Dans le volet **Explorateur** de la fenêtre **Visual Studio Code**, ouvrez le fichier **Program.cs**.

1.  Sous l’onglet de l’éditeur de code du fichier **Program.cs**, supprimez tout le code du fichier existant.

1.  Ajoutez la ligne de code suivante pour importer les espaces de noms **Azure.Storage**, **Azure.Storage.Blobs** et **Azure.Storage.Blobs.Models** à partir du package **Azure.Storage.Blobs** importés à partir de NuGet :

    ```csharp
    using Azure.Storage;
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    ```
    
1.  Ajoutez les lignes de code suivantes afin d’ajouter des directives **using** pour les espaces de noms intégrés qui seront utilisées dans ce fichier :

    ```csharp
    using System;
    using System.Threading.Tasks;
    ```

1.  Entrez le code suivant pour créer une classe **Program** :

    ```csharp
    public class Program
    {
    }
    ```

1.  Dans la classe **Program**, entrez la ligne de code suivante pour créer une constante de chaîne nommée **blobServiceEndpoint** :

    ```csharp
    private const string blobServiceEndpoint = "";
    ```

1.  Mettez à jour la constante de chaîne **blobServiceEndpoint** en définissant sa valeur sur le **Point de terminaison de service Blob principal** du compte de stockage que vous avez enregistré précédemment dans ce labo.

1.  Dans la classe **Program**, entrez la ligne de code suivante pour créer une constante de chaîne nommée **storageAccountName** :

    ```csharp
    private const string storageAccountName = "";
    ```

1.  Mettez à jour la constante de chaîne **storageAccountName** en définissant sa valeur sur le **Nom de compte de stockage** que vous avez enregistré précédemment dans ce labo.

1.  Dans la classe **Program**, entrez la ligne de code suivante pour créer une constante de chaîne nommée **storageAccountKey** :

    ```csharp
    private const string storageAccountKey = "";
    ```

1.  Mettez à jour la constante de chaîne **storageAccountKey** en définissant sa valeur sur la **Clé** du compte de stockage que vous avez enregistrée précédemment dans ce labo.

1.  Dans la classe **Program**, entrez le code suivant pour créer une méthode **Main** asynchrone :

    ```csharp
    public static async Task Main(string[] args)
    {
    }
    ```

1.  Examinez le fichier **Program.cs** qui devrait désormais inclure :

    ```csharp
    using Azure.Storage;
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    using System;
    using System.Threading.Tasks;    
    public class Program
    {
        private const string blobServiceEndpoint = "<primary-blob-service-endpoint>";
        private const string storageAccountName = "<storage-account-name>";
        private const string storageAccountKey = "<key>";    
        public static async Task Main(string[] args)
        {
        }
    }
    ```

#### <a name="task-3-connect-to-the-azure-storage-blob-service-endpoint"></a>Tâche 3 : Se connecter au point de terminaison du service Azure Storage Blob

1.  Dans la méthode **Main**, ajoutez la ligne de code suivante pour créer une instance de la classe **StorageSharedKeyCredential** en utilisant les constantes **storageAccountName** et **storageAccountKey** comme paramètres de constructeur :

    ```csharp
    StorageSharedKeyCredential accountCredentials = new StorageSharedKeyCredential(storageAccountName, storageAccountKey);
    ```

1.  Dans la méthode **Main** ajoutez la ligne de code suivante pour créer une instance de la classe **BlobServiceClient** en utilisant la constante **blobServiceEndpoint** et la variable *accountCredentials* en tant que paramètres de constructeur :

    ```csharp
    BlobServiceClient serviceClient = new BlobServiceClient(new Uri(blobServiceEndpoint), accountCredentials);
    ```

1.  Dans la méthode **Main**, ajoutez la ligne de code suivante pour appeler la méthode **GetAccountInfoAsync** de la classe **BlobServiceClient** pour récupérer les métadonnées du compte à partir du service :

    ```csharp
    AccountInfo info = await serviceClient.GetAccountInfoAsync();
    ```
    
1.  Dans la méthode **Main**, ajoutez la ligne de code suivante pour afficher un message d’accueil :

    ```csharp
    await Console.Out.WriteLineAsync($"Connected to Azure Storage Account");
    ```
    
1.  Dans la méthode **Main**, ajoutez la ligne de code suivante pour afficher le nom du compte de stockage :

    ```csharp
    await Console.Out.WriteLineAsync($"Account name:\t{storageAccountName}");
    ```
    
1.  Dans la méthode **Main**, ajoutez la ligne de code suivante pour afficher le type de compte de stockage :

    ```csharp
    await Console.Out.WriteLineAsync($"Account kind:\t{info?.AccountKind}");
    ```
    
1.  Dans la méthode **Main**, ajoutez la ligne de code suivante afin d’afficher la référence SKU actuellement sélectionnée pour le compte de stockage :

    ```csharp
    await Console.Out.WriteLineAsync($"Account sku:\t{info?.SkuName}");
    ```

1.  Examinez la méthode **Main** qui devrait désormais inclure :

    ```csharp
    public static async Task Main(string[] args)
    {
        StorageSharedKeyCredential accountCredentials = new StorageSharedKeyCredential(storageAccountName, storageAccountKey);
        BlobServiceClient serviceClient = new BlobServiceClient(new Uri(blobServiceEndpoint), accountCredentials);
        AccountInfo info = await serviceClient.GetAccountInfoAsync();
        await Console.Out.WriteLineAsync($"Connected to Azure Storage Account");
        await Console.Out.WriteLineAsync($"Account name:\t{storageAccountName}");
        await Console.Out.WriteLineAsync($"Account kind:\t{info?.AccountKind}");
        await Console.Out.WriteLineAsync($"Account sku:\t{info?.SkuName}");
    }
    ```

1.  Enregistrez le fichier **Program.cs**.

1.  Dans la fenêtre **Visual Studio Code**, dans la barre de menus, sélectionnez **Terminal**, puis **Nouveau terminal**.

1.  Dans le terminal, exécutez la commande suivante pour démarrer l’application web .NET :

    ```
    dotnet run
    ```

    > **Remarque** : s’il existe des erreurs de build, examinez le fichier **Program.cs** dans le dossier **Allfiles (F):\\Allfiles\\Labs\\03\\Solution\\BlobManager**.

1.  Observez la sortie de l’application console en cours d’exécution. La sortie contient des métadonnées pour le compte de stockage qui ont été récupérées à partir du service.

1.  Sélectionnez **Tuer le terminal** ou l’icône **Corbeille** pour fermer le terminal actuellement ouvert et tous les processus associés.

#### <a name="task-4-enumerate-the-existing-containers"></a>Tâche 4 : Énumérer les conteneurs existants

1.  Dans la classe **Program**, entrez le code suivant pour créer une méthode **statique privée** nommée **EnumerateContainersAsync**, qui est asynchrone et dispose d’un seul type de paramètre **BlobServiceClient** :

    ```csharp
    private static async Task EnumerateContainersAsync(BlobServiceClient client)
    {        
    }
    ```

1.  Dans la méthode **EnumerateContainersAsync**, entrez le code suivant pour créer une boucle **foreach** asynchrone qui itère sur les résultats d’un appel de la méthode **GetBlobContainersAsync** de la classe **BlobServiceClient** :

    ```csharp
    await foreach (BlobContainerItem container in client.GetBlobContainersAsync())
    {
    }
    ```

1.  Dans la boucle **foreach**, entrez le code suivant pour imprimer le nom de chaque conteneur :

    ```csharp
    await Console.Out.WriteLineAsync($"Container:\t{container.Name}");
    ```

1.  Examinez la méthode **EnumerateContainersAsync** qui devrait désormais inclure :

    ```csharp
    private static async Task EnumerateContainersAsync(BlobServiceClient client)
    {        
        await foreach (BlobContainerItem container in client.GetBlobContainersAsync())
        {
            await Console.Out.WriteLineAsync($"Container:\t{container.Name}");
        }
    }
    ```

1.  Dans la méthode **Main** , entrez le code suivant à la fin de la méthode pour appeler la méthode **EnumerateContainersAsync**, en passant la variable *serviceClient* comme paramètre :

    ```csharp
    await EnumerateContainersAsync(serviceClient);
    ```

1.  Observez le fichier **Program.cs** qui devrait maintenant inclure :
    ```csharp
    using Azure.Storage;
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    using System;
    using System.Threading.Tasks;
    
    public class Program
    {
        private const string blobServiceEndpoint = "your blobServiceEndpoint";
        private const string storageAccountName = "your storageAccountName";
        private const string storageAccountKey = "your storageAccountKey";    
        public static async Task Main(string[] args)
        {
            StorageSharedKeyCredential accountCredentials = new StorageSharedKeyCredential(storageAccountName, storageAccountKey);
            BlobServiceClient serviceClient = new     BlobServiceClient(new Uri(blobServiceEndpoint), accountCredentials);
            AccountInfo info = await serviceClient.GetAccountInfoAsync();
            await Console.Out.WriteLineAsync($"Connected to Azure Storage Account");
            await Console.Out.WriteLineAsync($"Account name:\t{storageAccountName}");
            await Console.Out.WriteLineAsync($"Account kind:\t{info?.AccountKind}");
            await Console.Out.WriteLineAsync($"Account sku:\t{info?.SkuName}");
            await EnumerateContainersAsync(serviceClient);
        }        
        private static async Task EnumerateContainersAsync(BlobServiceClient client)
        {        
            await foreach (BlobContainerItem container in client.GetBlobContainersAsync())
            {
                await Console.Out.WriteLineAsync($"Container:\t{container.Name}");
            }
    }
    }
    ```

1.  Enregistrez le fichier **Program.cs**.

1.  Dans la fenêtre **Visual Studio Code**, dans la barre de menus, sélectionnez **Terminal**, puis **Nouveau terminal**.

1.  Dans le terminal, exécutez la commande suivante pour démarrer l’application web .NET :

    ```
    dotnet run
    ```

    > **Remarque** : s’il existe des erreurs de build, examinez le fichier **Program.cs** dans le dossier **Allfiles (F):\\Allfiles\\Labs\\03\\Solution\\BlobManager**.

1.  Observez la sortie de l’application console en cours d’exécution. La sortie mise à jour inclut la liste des conteneurs existants dans le compte.

1.  Sélectionnez **Tuer le terminal** ou l’icône **Corbeille** pour fermer le terminal actuellement ouvert et tous les processus associés.

#### <a name="review"></a>Révision

Dans cet exercice, vous avez accédé à des conteneurs existants à l’aide du Kit de développement logiciel (SDK) Stockage Azure.

### <a name="exercise-4-retrieve-blob-uniform-resource-identifiers-uris-by-using-the-net-sdk"></a>Exercice 4 : Récupérer les URI de blob à l’aide du Kit de développement logiciel (SDK) .NET

#### <a name="task-1-enumerate-the-blobs-in-an-existing-container-by-using-the-sdk"></a>Tâche 1 : Énumérer les blobs dans un conteneur existant en utilisant le Kit de développement logiciel (SDK)

1.  Dans la classe **Program**, entrez le code suivant pour créer une méthode **statique privée** nommée **EnumerateBlobsAsync**, qui est asynchrone et dispose de deux types de paramètres, **BlobServiceClient** et **string** :

    ```csharp
    private static async Task EnumerateBlobsAsync(BlobServiceClient client, string containerName)
    {      
    }
    ```

1.  Dans la méthode **EnumerateBlobsAsync**, entrez le code suivant pour obtenir une nouvelle instance de la classe **BlobContainerClient** à l’aide de la méthode **GetBlobContainerClient** de la classe **BlobServiceClient**, en passant le paramètre **containerName** :

    ```csharp
    BlobContainerClient container = client.GetBlobContainerClient(containerName);
    ```

1.  Dans la méthode **EnumerateBlobsAsync**, entrez le code suivant pour afficher le nom du conteneur qui sera énuméré :

    ```csharp
    await Console.Out.WriteLineAsync($"Searching:\t{container.Name}");
    ```

1.  Dans la méthode **EnumerateBlobsAsync**, entrez le code suivant pour créer une boucle **foreach** asynchrone qui itère sur les résultats d’un appel de la méthode **GetBlobsAsync** de la classe **BlobContainerClient** :

    ```csharp
    await foreach (BlobItem blob in container.GetBlobsAsync())
    {        
    }
    ```

1.  Dans la boucle **foreach**, entrez le code suivant pour imprimer le nom de chaque blob :

    ```csharp
     await Console.Out.WriteLineAsync($"Existing Blob:\t{blob.Name}");
    ```

1.  Examinez la méthode **EnumerateBlobsAsync** qui devrait désormais inclure :

    ```csharp
    private static async Task EnumerateBlobsAsync(BlobServiceClient client, string containerName)
    {      
        BlobContainerClient container = client.GetBlobContainerClient(containerName);
        await Console.Out.WriteLineAsync($"Searching:\t{container.Name}");
        await foreach (BlobItem blob in container.GetBlobsAsync())
        {        
             await Console.Out.WriteLineAsync($"Existing Blob:\t{blob.Name}");
        }
    }
    ```

1.  Dans la méthode **Main**, entrez le code suivant à la fin de la méthode pour créer une variable nommée *existingContainerName* avec une valeur de **raster-graphics** :

    ```csharp
    string existingContainerName = "raster-graphics";
    ```

1.  Dans la méthode **Main**, entrez le code suivant à la fin de la méthode pour appeler la méthode **EnumerateBlobsAsync**, en passant les variables *serviceClient* et *existingContainerName* comme paramètres :

    ```csharp
    await EnumerateBlobsAsync(serviceClient, existingContainerName);
    ```

1.  Observez le fichier **Program.cs** qui devrait maintenant inclure :
    ```csharp
    using Azure.Storage;
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    using System;
    using System.Threading.Tasks;    
    public class Program
    {
        private const string blobServiceEndpoint = "your blobServiceEndpoint";
        private const string storageAccountName = "your storageAccountName";
        private const string storageAccountKey = "your storageAccountKey";    
        public static async Task Main(string[] args)
        {
            StorageSharedKeyCredential accountCredentials = new StorageSharedKeyCredential(storageAccountName, storageAccountKey);
            BlobServiceClient serviceClient = new   BlobServiceClient(new Uri(blobServiceEndpoint), accountCredentials);
            AccountInfo info = await serviceClient.GetAccountInfoAsync();
            await Console.Out.WriteLineAsync($"Connected to Azure Storage Account");
            await Console.Out.WriteLineAsync($"Account name:\t{storageAccountName}");
            await Console.Out.WriteLineAsync($"Account kind:\t{info?.AccountKind}");
            await Console.Out.WriteLineAsync($"Account sku:\t{info?.SkuName}");
            await EnumerateContainersAsync(serviceClient);
            string existingContainerName = "raster-graphics";
            await EnumerateBlobsAsync(serviceClient, existingContainerName);
        }        
        private static async Task EnumerateContainersAsync(BlobServiceClient client)
        {        
            await foreach (BlobContainerItem container in client.GetBlobContainersAsync())
            {
                await Console.Out.WriteLineAsync($"Container:\t{container.Name}");
            }
        }        
        private static async Task EnumerateBlobsAsync(BlobServiceClient client, string containerName)
        {      
            BlobContainerClient container = client.GetBlobContainerClient(containerName);await Console.Out.WriteLineAsync($"Searching:\t{container.Name}");
            await foreach (BlobItem blob in container.GetBlobsAsync())
            {        
                await Console.Out.WriteLineAsync($"Existing Blob:\t{blob.Name}");
            }
        }
    }
    ```

1.  Enregistrez le fichier **Program.cs**.

1.  Dans la fenêtre **Visual Studio Code**, dans la barre de menus, sélectionnez **Terminal**, puis **Nouveau terminal**.

1.  Dans le terminal, exécutez la commande suivante pour démarrer l’application web .NET :

    ```
    dotnet run
    ```

    > **Remarque** : s’il existe des erreurs de build, examinez le fichier **Program.cs** dans le dossier **Allfiles (F):\\Allfiles\\Labs\\03\\Solution\\BlobManager**.

1.  Examinez la sortie de l’application console en cours d’exécution. La sortie mise à jour inclut des métadonnées sur le conteneur et les blob existants.

1.  Sélectionnez **Tuer le terminal** ou l’icône **Corbeille** pour fermer le terminal actuellement ouvert et tous les processus associés.

#### <a name="task-2-create-a-new-container-by-using-the-sdk"></a>Tâche 2 : Créer un conteneur en utilisant le Kit de développement logiciel (SDK)

1.  Dans la classe **Program**, entrez le code suivant pour créer une méthode **statique privée** nommée **GetContainerAsync**, qui est asynchrone et dispose de deux types de paramètres, **BlobServiceClient** et **string** :

    ```csharp
    private static async Task<BlobContainerClient> GetContainerAsync(BlobServiceClient client, string containerName)
    {      
    }
    ```

1.  Dans la méthode **GetContainerAsync**, entrez le code suivant pour obtenir une nouvelle instance de la classe **BlobContainerClient** à l’aide de la méthode **GetBlobContainerClient** de la classe **BlobServiceClient**, en passant le paramètre **containerName** :

    ```csharp
    BlobContainerClient container = client.GetBlobContainerClient(containerName);
    ```

1.  Dans la méthode **GetContainerAsync**, entrez le code suivant pour appeler la méthode **CreateIfNotExistsAsync** de la classe **BlobContainerClient** :

    ```csharp
    await container.CreateIfNotExistsAsync(PublicAccessType.Blob);
    ```

1.  Dans la méthode **GetContainerAsync**, entrez le code suivant pour afficher le nom du conteneur potentiellement créé :

    ```csharp
    await Console.Out.WriteLineAsync($"New Container:\t{container.Name}");
    ```

1.  Dans la méthode **GetContainerAsync**, entrez le code suivant pour renvoyer l’instance de la classe **BlobContainerClient** nommée **container** comme résultat de la méthode **GetContainerAsync** :

    ```csharp
    return container;
    ```

1.  Examinez la méthode **GetContainerAsync** qui devrait désormais inclure :

    ```csharp
    private static async Task<BlobContainerClient> GetContainerAsync(BlobServiceClient client, string containerName)
    {      
        BlobContainerClient container = client.GetBlobContainerClient(containerName);
        await container.CreateIfNotExistsAsync(PublicAccessType.Blob);
        await Console.Out.WriteLineAsync($"New Container:\t{container.Name}");        
        return container;
    }
    ```

1.  Dans la méthode **Main**, entrez le code suivant à la fin de la méthode pour créer une variable nommée *newContainerName* avec une valeur de **vector-graphics** :

    ```csharp
    string newContainerName = "vector-graphics";
    ```

1.  Dans la méthode **Main**, entrez le code suivant à la fin de la méthode pour appeler la méthode **GetContainerAsync**, afin de transmettre les variables *serviceClient* et *newContainerName* comme paramètres, et de stocker le résultat dans une variable nommée *containerClient* de type **BlobContainerClient** :

    ```csharp
    BlobContainerClient containerClient = await GetContainerAsync(serviceClient, newContainerName);
    ```

1.  Examinez le fichier **Program.cs** qui devrait désormais inclure :
    ```csharp
    using Azure.Storage;
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    using System;
    using System.Threading.Tasks;    
    public class Program
    {
        private const string blobServiceEndpoint = "your blobServiceEndpoint";
        private const string storageAccountName = "your storageAccountName";
        private const string storageAccountKey = "your storageAccountKey";
        public static async Task Main(string[] args)
        {
            StorageSharedKeyCredential accountCredentials = new StorageSharedKeyCredential(storageAccountName, storageAccountKey);
            BlobServiceClient serviceClient = new BlobServiceClient(new Uri(blobServiceEndpoint), accountCredentials);
            AccountInfo info = await serviceClient.GetAccountInfoAsync();
            await Console.Out.WriteLineAsync($"Connected to Azure Storage Account");
            await Console.Out.WriteLineAsync($"Account name:\t{storageAccountName}");
            await Console.Out.WriteLineAsync($"Account kind:\t{info?.AccountKind}");
            await Console.Out.WriteLineAsync($"Account sku:\t{info?.SkuName}");
            await EnumerateContainersAsync(serviceClient);
            string existingContainerName = "raster-graphics";
            await EnumerateBlobsAsync(serviceClient, existingContainerName);
            string newContainerName = "vector-graphics";
            BlobContainerClient containerClient = await GetContainerAsync(serviceClient, newContainerName);
        }        
        private static async Task EnumerateContainersAsync(BlobServiceClient client)
        {        
            await foreach (BlobContainerItem container in client.GetBlobContainersAsync())
            {
                await Console.Out.WriteLineAsync($"Container:\t{container.Name}");
            }
        }        
        private static async Task EnumerateBlobsAsync(BlobServiceClient client, string containerName)
        {      
            BlobContainerClient container = client.GetBlobContainerClient(containerName);await Console.Out.WriteLineAsync($"Searching:\t{container.Name}");
            await foreach (BlobItem blob in container.GetBlobsAsync())
            {        
                await Console.Out.WriteLineAsync($"Existing Blob:\t{blob.Name}");
            }
        }        
        private static async Task<BlobContainerClient> GetContainerAsync(BlobServiceClient client, string containerName)
        {      
            BlobContainerClient container = client.GetBlobContainerClient(containerName);
            await container.CreateIfNotExistsAsync(PublicAccessType.Blob);
            await Console.Out.WriteLineAsync($"New Container:\t{container.Name}");
            return container;
        }
    }
    ```

1.  Enregistrez le fichier **Program.cs**.

1.  Dans la fenêtre **Visual Studio Code**, dans la barre de menus, sélectionnez **Terminal**, puis **Nouveau terminal**.

1.  Dans le terminal, exécutez la commande suivante pour démarrer l’application web .NET :

    ```
    dotnet run
    ```

    > **Remarque** : s’il existe des erreurs de build, examinez le fichier **Program.cs** dans le dossier **Allfiles (F):\\Allfiles\\Labs\\03\\Solution\\BlobManager**.

1.  Observez la sortie de l’application console en cours d’exécution. La sortie mise à jour inclut des métadonnées sur le conteneur et les blob existants.

1.  Sélectionnez **Tuer le terminal** ou l’icône **Corbeille** pour fermer le terminal actuellement ouvert et tous les processus associés.

#### <a name="task-3-upload-a-new-blob-by-using-the-portal"></a>Tâche 3 : Charger un nouveau blob à l’aide du portail

1.  Dans le volet de **navigation** du portail Azure, sélectionnez le lien **Groupes de ressources**.

1.  Dans le volet **Groupes de ressources**, sélectionnez le groupe de ressources **StorageMedia** que vous avez créé précédemment dans ce labo.

1.  Dans le panneau **StorageMedia**, sélectionnez le compte de stockage **mediastor** _[votrenom]_ que vous avez créé précédemment dans ce labo.

1.  Dans le volet **Compte de stockage**, dans la section **Stockage des données**, sélectionnez le lien **Conteneurs**.

1.  Dans la section **Conteneurs**, sélectionnez le conteneur **vector-graphics** nouvellement créé. Il se pourrait que vous deviez actualiser la page pour observer le nouveau conteneur.

1.  Dans le volet **Conteneur**, sélectionnez **Charger**.

1.  Dans la fenêtre **Charger l’objet blob**, effectuez les actions suivantes, puis sélectionnez **Charger** :

    | Paramètre | Action |
    | -- | -- |
    | Dans la section **Fichiers**, sélectionnez l’icône **Dossier** |
    | Fenêtre **Explorateur de fichiers** |  **Allfiles (F):\\Allfiles\\Labs\\03\\Starter\\Images**, sélectionnez le fichier **graph.svg**, puis **Ouvrir** |
    | Case à cocher **Remplacer si les fichiers existent déjà** | Vérifiez que la case est cochée |

    > **Remarque** : attendez que le chargement du blob soit terminé avant de poursuivre ce labo.

#### <a name="task-4-access-blob-uri-by-using-the-sdk"></a>Tâche 4 : Accéder à une URI de blob à l’aide du Kit de développement logiciel (SDK)

1.  Passez à la fenêtre **Visual Studio Code**.

1.  Dans la classe **Program**, entrez le code suivant pour créer une méthode **statique privée** nommée **GetBlobAsync**, qui est asynchrone et dispose de deux types de paramètres, **BlobContainerClient** et **string** :

    ```csharp
    private static async Task<BlobClient> GetBlobAsync(BlobContainerClient client, string blobName)
    {      
    }
    ```

1.  Dans la méthode **GetBlobAsync**, entrez le code suivant pour obtenir une nouvelle instance de la classe **BlobClient** en utilisant la méthode **GetBlobClient** de la classe **BlobContainerClient**, et pour passer le paramètre **blobName** :

    ```csharp
    BlobClient blob = client.GetBlobClient(blobName);
    ```

1.  Dans la méthode **GetBlobAsync**, entrez le code suivant pour afficher le nom du blob référencé :

    ```csharp
    await Console.Out.WriteLineAsync($"Blob Found:\t{blob.Name}");
    ```

1.  Dans la méthode **GetBlobAsync**, entrez le code suivant pour renvoyer l’instance de la classe **BlobClient** nommée **blob** comme résultat de la méthode **GetBlobAsync** :

    ```csharp
    return blob;
    ```

1.  Examinez la méthode **GetBlobAsync** qui devrait désormais inclure :

    ```csharp
    private static async Task<BlobClient> GetBlobAsync(BlobContainerClient client, string blobName)
    {      
        BlobClient blob = client.GetBlobClient(blobName);
        await Console.Out.WriteLineAsync($"Blob Found:\t{blob.Name}");
        return blob;
    }
    ```

1.  Dans la méthode **Main**, entrez le code suivant à la fin de la méthode pour créer une variable nommée *newContainerName* avec une valeur de **graph.svg** :

    ```csharp
    string uploadedBlobName = "graph.svg";
    ```

1.  Dans la méthode **Main**, entrez le code suivant à la fin de la méthode pour appeler la méthode **GetBlobAsync**, en passant les variables *containerClient* et *uploadBlobName* en tant que paramètres, et stocker le résultat dans une variable nommée *blobClient* de type **BlobClient** :

    ```csharp
    BlobClient blobClient = await GetBlobAsync(containerClient, uploadedBlobName);
    ```

1.  Dans la méthode **Main** , entrez le code suivant à la fin de la méthode pour afficher la propriété **Uri** de la variable *blobClient* :

    ```csharp
    await Console.Out.WriteLineAsync($"Blob Url:\t{blobClient.Uri}");
    ```

1.  Observez le fichier **Program.cs** qui devrait maintenant inclure :
    ```csharp
    using Azure.Storage;
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    using System;
    using System.Threading.Tasks;    
    public class Program
    {
        private const string blobServiceEndpoint = "your blobServiceEndpoint";
        private const string storageAccountName = "your storageAccountName";
        private const string storageAccountKey = "your storageAccountKey";    
        public static async Task Main(string[] args)
        {
            StorageSharedKeyCredential accountCredentials = new StorageSharedKeyCredential(storageAccountName, storageAccountKey);
            BlobServiceClient serviceClient = new BlobServiceClient(new Uri(blobServiceEndpoint), accountCredentials);
            AccountInfo info = await serviceClient.GetAccountInfoAsync();
            await Console.Out.WriteLineAsync($"Connected to Azure Storage Account");
            await Console.Out.WriteLineAsync($"Account name:\t{storageAccountName}");
            await Console.Out.WriteLineAsync($"Account kind:\t{info?.AccountKind}");
            await Console.Out.WriteLineAsync($"Account sku:\t{info?.SkuName}");
            await EnumerateContainersAsync(serviceClient);
            string existingContainerName = "raster-graphics";
            await EnumerateBlobsAsync(serviceClient, existingContainerName);
            string newContainerName = "vector-graphics";
            BlobContainerClient containerClient = await GetContainerAsync(serviceClient, newContainerName);
            string uploadedBlobName = "graph.svg";
            BlobClient blobClient = await GetBlobAsync(containerClient, uploadedBlobName);
            await Console.Out.WriteLineAsync($"Blob Url:\t{blobClient.Uri}");
        }        
        private static async Task EnumerateContainersAsync(BlobServiceClient client)
        {        
            await foreach (BlobContainerItem container in client.GetBlobContainersAsync())
            {
                await Console.Out.WriteLineAsync($"Container:\t{container.Name}");
            }
        }        
        private static async Task EnumerateBlobsAsync(BlobServiceClient client, string containerName)
        {      
            BlobContainerClient container = client.GetBlobContainerClient(containerName);
            await Console.Out.WriteLineAsync($"Searching:\t{container.Name}");
            await foreach (BlobItem blob in container.GetBlobsAsync())
            {        
                await Console.Out.WriteLineAsync($"Existing Blob:\t{blob.Name}");
            }
        }        
        private static async Task<BlobContainerClient> GetContainerAsync(BlobServiceClient client, string containerName)
        {      
            BlobContainerClient container = client.GetBlobContainerClient(containerName);

            await container.CreateIfNotExistsAsync(PublicAccessType.Blob);
            await Console.Out.WriteLineAsync($"New Container:\t{container.Name}");
            return container;
        }        
        private static async Task<BlobClient> GetBlobAsync(BlobContainerClient client, string blobName)
        {      
            BlobClient blob = client.GetBlobClient(blobName);
            await Console.Out.WriteLineAsync($"Blob Found:\t{blob.Name}");
            return blob;
        }
    }
    ```

1.  Enregistrez le fichier **Program.cs**.

1.  Dans la fenêtre **Visual Studio Code**, activez le menu contextuel pour le volet **Explorateur**, puis sélectionnez **Ouvrir dans le terminal intégré**.

1.  À l’invite de commandes ouverte, exécutez la commande suivante pour exécuter l’application web .NET :

    ```
    dotnet run
    ```

    > **Remarque** : s’il existe des erreurs de build, examinez le fichier **Program.cs** dans le dossier **Allfiles (F):\\Allfiles\\Labs\\03\\Solution\\BlobManager**.

1.  Observez la sortie de l’application console en cours d’exécution. La sortie mise à jour inclut l’URL finale pour au blob en ligne. Enregistrez la valeur de cette URL, que vous utilisez plus tard dans le laboratoire.

    > **Remarque** : l’URL sera probablement similaire à la chaîne suivante : `https://mediastor*[yourname]*.blob.core.windows.net/vector-graphics/graph.svg`

1.  Sélectionnez **Tuer le terminal** ou l’icône **Corbeille** pour fermer le terminal actuellement ouvert et tous les processus associés.

#### <a name="task-5-test-the-uri-by-using-a-browser"></a>Tâche 5 : Tester l’URI à l’aide d’un navigateur

1.  Dans la barre des tâches, activez le menu contextuel pour l’icône **Microsoft Edge**, puis sélectionnez **Nouvelle fenêtre**.

1.  Dans la nouvelle fenêtre du navigateur, reportez-vous à l’URL que vous avez précédemment copiée dans ce labo pour le blob.

1.  Vous devriez maintenant voir le fichier SVG (Scalable Vector Graphics) dans votre fenêtre de navigateur.

#### <a name="review"></a>Révision

Dans cet exercice, vous avez créé des conteneurs et des blob managés à l’aide du Kit de développement logiciel (SDK) Stockage.

### <a name="exercise-5-clean-up-your-subscription"></a>Exercice 5 : Nettoyer votre abonnement

#### <a name="task-1-open-azure-cloud-shell"></a>Tâche 1 : Ouvrir Azure Cloud Shell

1.  Dans le portail Azure, sélectionnez l’icône **Cloud Shell** ![icône Cloud Shell](./media/az204_lab_CloudShell.png) pour ouvrir une nouvelle session Bash. Si Cloud Shell est défini par défaut sur une session PowerShell, sélectionnez **PowerShell**, puis, dans le menu déroulant, sélectionnez **Bash**.

    > **Remarque** : si vous démarrez **Cloud Shell** pour la première fois, lorsque vous êtes invité à sélectionner **Bash** ou **PowerShell**, sélectionnez **PowerShell**. Lorsque vous voyez le message **Vous n’avez aucun stockage monté**, sélectionnez l’abonnement que vous utilisez dans ce labo, puis choisissez **Créer un stockage**.

#### <a name="task-2-delete-a-resource-group"></a>Tâche 2 : Supprimer un groupe de ressources

1.  Dans le volet **Cloud Shell**, exécutez la commande suivante pour supprimer le groupe de ressources **StorageMedia** :

    ```
    az group delete --name StorageMedia --no-wait --yes
    ```
     > **Remarque** : la commande s’exécute de façon asynchrone (comme déterminé par le paramètre *--nowait*). Par conséquent, vous êtes en mesure d’exécuter une autre commande Azure CLI immédiatement après au cours de la même session Bash, mais la suppression du groupe de ressources peut prendre quelques minutes.

1.  Fermez le volet **Cloud Shell** dans le portail.

1.  Fermez Visual Studio Code.

#### <a name="task-3-close-the-active-application"></a>Tâche 3 : Fermer l’application active

- Fermez l’application Microsoft Edge en cours d’exécution.

#### <a name="review"></a>Révision

Dans cet exercice, vous avez nettoyé votre abonnement en supprimant le groupe de ressources utilisé dans ce labo.
